---
title: 数据库游标的使用
date: 2018-11-03 09:37:01
tags: [数据库,SQLServer] 
categories: "数据库"
---
> 
<!-- more -->
## 数据库游标
##### 游标FOR循环
###### 1、打开游标
###### 2、开始循环
###### 3、从游标中取值
###### 4、检查那一行被返回
###### 5、处理
###### 6、关闭循环
###### 7、关闭游标
---

```
declare @drcs int
declare @kscs int
declare @zkzmbh varchar (50)
--  定义一个游标
DECLARE updatecs CURSOR FOR SELECT 准考证明编号 FROM Studentinfo
--  打开游标
OPEN updatecs
FETCH NEXT FROM updatecs INTO @zkzmbh
WHILE @@FETCH_STATUS=0
        BEGIN
        if exists (select * from examrecord where 准考证明编号=@zkzmbh)--先查询在examrecord是否存在记录
	begin
		select @kscs=Max(考试次数) from examrecord where 准考证明编号=@zkzmbh
		select @drcs=Max(当日次数) from examrecord where 准考证明编号=@zkzmbh and 考试次数=@kscs
		update studentinfo set 考试次数=@kscs,当日次数=@drcs where 准考证明编号=@zkzmbh
	end
	FETCH NEXT FROM updatecs INTO @zkzmbh --取下一条
        END
-- 关闭游标
CLOSE updatecs
DEALLOCATE updatecs --(删除游标)
```